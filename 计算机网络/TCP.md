# TCP

# TCP 三次握手

第一步：
客户端的 TCP 向服务器端的 TCP 发送一个 TCP 报文段。
该报文段不包含应用层数据。但是报文段首部的 SYN 被设置为 1。
这个报文段也被称为 SYN 报文段段。并且会在这个报文段的序号字段中会被放入一个随机初始序号。

第二步：
当这个包含 SYN 报文段的 IP 数据到达了服务器主机后。
服务器会从这个 IP 数据中提取出 TCP SYN 报文段，并为这个 TCP 连接分配 TCP 缓存和变量，然后向客户 TCP 发送允许连接的报文段。
那这个报文段也不包含应用层数据。它的 SYN 依旧是 1，并且会选择自己的一个初始序号。最后还会附加一个确认号，也就是 ACK，那么这个 ACK 的值，是客户端当时所生的随机初始序号+1.

第三步：
客户端收到后，也会给这个 TCP 连接分配缓存和变量。并返回一个 TCP 报文段。这个报文段的 SYN 变为 0，序列号是客户端一开始生成的序列号+1，再附加一个 ACK，这个 ACK 的值是服务器端的序列号+1.

客户端 服务端
SYN=1,seq=client_seq

                            SYN=1,seq=server_seq,ACK=client_seq+1

SYN=0,seq=client_seq+1,ACK=server_seq+1

这三个步骤完成之后，就可以开始相互发送包含数据的报文段了。之后的 SYN 一般都会被设置为 0。这整个流程一般是三步，所以也就被称为三次握手。

四次挥手
第一步：
客户端会向服务器发送一个标志位为 FIN 的报文段，FIN 比特被设置为 1.
第二步：
服务器收到后，会发送一个确认报文段 ACK。
第三步：
之后服务器也向客户端发送一个终止报文段，标志位也为 FIN，FIN 比特也是 1.
第四步：
客户对从服务器收到的终止报文段进行确认，发送确认字段 ACK。

至此四次挥手就结束了。两台主机也会各自释放所有资源。

客户端 服务端
FIN=1,seq=u
ACK=1,seq=v,ack=u+1
FIN=1,ACK=1,seq=w,ack=u+1
ACK=1,seq=u+1,ack=w+1
